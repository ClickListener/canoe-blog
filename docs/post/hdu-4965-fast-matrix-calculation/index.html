<!DOCTYPE html><html lang="zh-cn"><head><meta charset="UTF-8"><title>HDU 4965 Fast Matrix Calculation | World of Forks</title><meta name="viewport" content="width=device-width,user-scalable=no,maximum-scale=1,initial-scale=1"><link rel="canonical" href="http://keyin.me/post/hdu-4965-fast-matrix-calculation/"><link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"><link href="//cdn.bootcss.com/highlight.js/9.12.0/styles/ocean.min.css" rel="stylesheet"><link rel="stylesheet" href="http://keyin.me/css/index-c9c4ce3d9f.css"><link href="http://keyin.me/index.xml" rel="alternate" type="application/rss+xml" title="World of Forks"><link href="http://keyin.me/index.xml" rel="feed" type="application/rss+xml" title="World of Forks"><link href="http://keyin.me/favicon.ico" rel="shortcut icon"></head><body><div id="modal1" class="modal"><div class="modal-content"><form action="//www.google.com/search" method="get" accept-charset="utf-8"><input type="hidden" name="sitesearch" value="http://keyin.me"><div class="input-field"><input placeholder="Search" id="input-search" name="q" type="text" required aria-required="true"></div></form></div></div><div class="navbar-fixed"><nav class="navbar"><div class="nav-wrapper container"><a href="javascript:void(0)" class="button-collapse"><i class="material-icons">menu</i></a> <a href="http://keyin.me" class="brand-logo"><i class="material-icons">restaurant_menu</i> World of Forks</a><ul class="right hide-on-med-and-down"><li><a class="modal-trigger" href="#modal1"><i class="material-icons">search</i></a></li><li><a href="http://keyin.me/index.xml" target="_blank"><i class="material-icons">rss_feed</i></a></li></ul><ul class="center tabs tabs-transparent hide-on-med-and-down"><li class="tab"><a href="http://keyin.me/" class="">Home</a></li><li class="tab"><a href="http://keyin.me/archive/" class="">Archive</a></li><li class="tab"><a href="http://keyin.me/about/" class="">About</a></li></ul></div></nav></div><aside class="side-panel"><div class="inner"><div class="profile"><div class="profile__bg" style="background-image:url('http://keyin.me/img/profile-bg-7c6e6a1672.jpg')"></div><img class="profile__avatar" src="http://keyin.me/img/avatar-66318e716f.png" alt="avatar"><h3 class="profile__name">Kevin Tan</h3><p class="profile__desc">Tempora mutantur, nos et mutamur in illis ...</p></div><ul class="nav-group show-on-medium-and-down menu"><li><a class="collapsible-header waves-effect waves-indigo" href="http://keyin.me/"><i class="material-icons">home</i> <span class="content">Home</span> <i class="material-icons">chevron_right</i></a></li><li><a class="collapsible-header waves-effect waves-indigo" href="http://keyin.me/archive/"><i class="material-icons">archive</i> <span class="content">Archive</span> <i class="material-icons">chevron_right</i></a></li><li><a class="collapsible-header waves-effect waves-indigo" href="http://keyin.me/about/"><i class="material-icons">person</i> <span class="content">About</span> <i class="material-icons">chevron_right</i></a></li><li><a class="collapsible-header waves-effect waves-indigo modal-trigger" href="#modal1"><i class="material-icons">search</i> <span class="content">Search</span> <i class="material-icons">chevron_right</i></a></li><li><a class="collapsible-header waves-effect waves-indigo" target="_blank" href="http://keyin.me/index.xml"><i class="material-icons">rss_feed</i> <span class="content">RSS Feed</span> <i class="material-icons">chevron_right</i></a></li></ul><ul class="collapsible nav-group" data-collapsible="accordion"><li><div class="collapsible-header waves-effect waves-indigo"><i class="material-icons">whatshot</i> <span class="content">Latest</span> <i class="material-icons angle">expand_more</i></div><div class="collapsible-body"><div class="collection"><a class="collection-item" href="http://keyin.me/post/polymer-2-7-helper-element/">Polymer 2.0 文档笔记(7) Helper Element</a> <a class="collection-item" href="http://keyin.me/post/polymer-2-6-data-binding/">Polymer 2.0 文档笔记(6) Data Binding</a> <a class="collection-item" href="http://keyin.me/post/polymer-2-5-observers-and-computed-properties/">Polymer 2.0 文档笔记(5) Observers &amp;&amp; Computed Properites</a> <a class="collection-item" href="http://keyin.me/post/polymer-2-4-data-system/">Polymer 2.0 文档笔记(4) Data System</a> <a class="collection-item" href="http://keyin.me/post/polymer-2-3-events/">Polymer 2.0 文档笔记(3) Events</a> <a class="collection-item" href="http://keyin.me/post/polymer-2-2-shadowdom/">Polymer 2.0 文档笔记(2) ShadowDOM</a> <a class="collection-item" href="http://keyin.me/post/polymer-2-1-custom-elements/">Polymer 2.0 文档笔记(1) Custom Elements</a> <a class="collection-item" href="http://keyin.me/post/hello-world/">网易云音乐新API浅析</a> <a class="collection-item" href="http://keyin.me/post/shadowsocks-account/">Shadowsocks免费账号网址集</a> <a class="collection-item" href="http://keyin.me/post/asp-net-mvc4note2/">ASP.NET MVC 4笔记（二）</a></div></div></li><li><div class="collapsible-header waves-effect waves-indigo"><i class="material-icons">view_list</i> <span class="content">Category </span><i class="material-icons angle">expand_more</i></div><div class="collapsible-body"><div class="collection"><a class="collection-item" href="http://keyin.me/categories/acm">acm<span class="badge">18</span></a> <a class="collection-item" href="http://keyin.me/categories/web">web<span class="badge">7</span></a> <a class="collection-item" href="http://keyin.me/categories/08">08<span class="badge">3</span></a> <a class="collection-item" href="http://keyin.me/categories/07">07<span class="badge">2</span></a> <a class="collection-item" href="http://keyin.me/categories/10">10<span class="badge">2</span></a> <a class="collection-item" href="http://keyin.me/categories/11">11<span class="badge">2</span></a> <a class="collection-item" href="http://keyin.me/categories/02">02<span class="badge">1</span></a> <a class="collection-item" href="http://keyin.me/categories/09">09<span class="badge">1</span></a> <a class="collection-item" href="http://keyin.me/categories/asp.net">asp.net<span class="badge">1</span></a> <a class="collection-item" href="http://keyin.me/categories/ide/editor">ide/editor<span class="badge">1</span></a> <a class="collection-item" href="http://keyin.me/categories/wine">wine<span class="badge">1</span></a></div></div></li><li><div class="collapsible-header waves-effect waves-indigo"><i class="material-icons">local_offer</i> <span class="content">Tag </span><i class="material-icons angle">expand_more</i></div><div class="collapsible-body"><div class="collection"><a class="collection-item" href="http://keyin.me/tags/polymer">polymer<span class="badge">7</span></a> <a class="collection-item" href="http://keyin.me/tags/tarjan">tarjan<span class="badge">5</span></a> <a class="collection-item" href="http://keyin.me/tags/%E5%9B%BE%E8%AE%BA">图论<span class="badge">5</span></a> <a class="collection-item" href="http://keyin.me/tags/lca">lca<span class="badge">3</span></a> <a class="collection-item" href="http://keyin.me/tags/asp.net-mvc4">asp.net-mvc4<span class="badge">1</span></a> <a class="collection-item" href="http://keyin.me/tags/c">c#<span class="badge">1</span></a> <a class="collection-item" href="http://keyin.me/tags/rmq">rmq<span class="badge">1</span></a> <a class="collection-item" href="http://keyin.me/tags/%E5%80%8D%E5%A2%9E">倍增<span class="badge">1</span></a> <a class="collection-item" href="http://keyin.me/tags/%E6%9A%B4%E5%8A%9B">暴力<span class="badge">1</span></a> <a class="collection-item" href="http://keyin.me/tags/%E6%A0%91%E5%BD%A2dp">树形dp<span class="badge">1</span></a> <a class="collection-item" href="http://keyin.me/tags/%E6%A0%91%E7%9A%84%E7%9B%B4%E5%BE%84">树的直径<span class="badge">1</span></a> <a class="collection-item" href="http://keyin.me/tags/%E7%9F%A9%E9%98%B5%E6%9A%B4%E5%8A%9B">矩阵暴力<span class="badge">1</span></a></div></div></li></ul><ul class="nav-group external-link"><li><a class="collapsible-header waves-effect waves-indigo" href="https://github.com/stkevintan" target="_blank"><svg class="svg-icons svg-icons-github"><use xlink:href="#svg-icons-github"></use></svg> <span class="content">Github<small>@stkevintan</small></span> <i class="material-icons">chevron_right</i></a></li><li><a class="collapsible-header waves-effect waves-indigo" href="https://twitter.com/kevinsfork" target="_blank"><svg class="svg-icons svg-icons-twitter"><use xlink:href="#svg-icons-twitter"></use></svg> <span class="content">Twitter<small>@kevinsfork</small></span> <i class="material-icons">chevron_right</i></a></li><li><a class="collapsible-header waves-effect waves-indigo" href="http://weibo.com/kevinclasky" target="_blank"><svg class="svg-icons svg-icons-sina-weibo"><use xlink:href="#svg-icons-sina-weibo"></use></svg> <span class="content">Weibo<small>@白夜繁星o_O</small></span> <i class="material-icons">chevron_right</i></a></li></ul></div></aside><main id="single" role="main" class="main-panel"><section class="container"><div class="inner"><div class="breadcrumbs" role="navigation" aria-label="breadcrumbs navigation"><a class="breadcrumb" href="http://keyin.me"><i class="material-icons">location_on</i>Home</a> <a class="breadcrumb" href="http://keyin.me/post/">Post</a> <span class="breadcrumb">HDU 4965 Fast Matrix Calculation</span></div><section class="post-wrapper"><div class="toc-panel"></div><div class="post"><div class="card"><div class="card-content"><span class="card-title">HDU 4965 Fast Matrix Calculation </span><span class="card-meta"><time><span>2014-6-20</span></time><address><a href="http://keyin.me/categories/acm">ACM</a>&nbsp;</address></span><article class="article"><p><strong><span style="font-family: Arial; font-size: 12px; font-weight: bold; color: green">Time Limit: <sup>2000</sup>&frasl;<sub>1000</sub> MS (Java/Others)    Memory Limit: <sup>131072</sup>&frasl;<sub>131072</sub> K (Java/Others) Total Submission(s): 206    Accepted Submission(s): 116</span></strong></p><div class="panel_title" align="left">Problem Description</div><div class="panel_content"><p></p><p>One day, Alice and Bob felt bored again, Bob knows Alice is a girl who loves math and is just learning something about matrix, so he decided to make a crazy problem for her.</p><p>Bob has a six-faced dice which has numbers 0, 1, 2, 3, 4 and 5 on each face. At first, he will choose a number N (4 &lt;= N &lt;= 1000), and for N times, he keeps throwing his dice for K times (2 &lt;=K &lt;= 6) and writes down its number on the top face to make an N*K matrix A, in which each element is not less than 0 and not greater than 5. Then he does similar thing again with a bit difference: he keeps throwing his dice for N times and each time repeat it for K times to write down a K*N matrix B, in which each element is not less than 0 and not greater than 5. With the two matrix A and B formed, Alice’s task is to perform the following 4-step calculation. Step 1: Calculate a new N*N matrix C = A*B. Step 2: Calculate M = C^(N*N). Step 3: For each element x in M, calculate x % 6. All the remainders form a new matrix M’. Step 4: Calculate the sum of all the elements in M’.</p><p>Bob just made this problem for kidding but he sees Alice taking it serious, so he also wonders what the answer is. And then Bob turn to you for help because he is not good at math.</p><p></p></div><div class="panel_bottom"></div>&nbsp;<div class="panel_title" align="left">Input</div><div class="panel_content"><p></p><p>The input contains several test cases. Each test case starts with two integer N and K, indicating the numbers N and K described above. Then N lines follow, and each line has K integers between 0 and 5, representing matrix A. Then K lines follow, and each line has N integers between 0 and 5, representing matrix B.</p><p>The end of input is indicated by N = K = 0.</p><p></p></div><div class="panel_bottom"></div>&nbsp;<div class="panel_title" align="left">Output</div><div class="panel_content">For each case, output the sum of all the elements in M’ in a line.</div><div class="panel_bottom"></div>&nbsp;<div class="panel_title" align="left">Sample Input</div><div class="panel_content"><div style="font-family: Courier New,Courier,monospace">4 2 5 5 4 4 5 4 0 0 4 2 5 5 1 3 1 5 6 3 1 2 3 0 3 0 2 3 4 4 3 2 2 5 5 0 5 0 3 4 5 1 1 0 5 3 2 3 3 2 3 1 5 4 5 2 0 0</div></div><div class="panel_bottom"></div>&nbsp;<div class="panel_title" align="left">Sample Output</div><div class="panel_content"><div style="font-family: Courier New,Courier,monospace">14 56</div></div><div class="panel_bottom"></div>&nbsp;<div class="panel_title" align="left">Source</div><div class="panel_content"><a href="http://acm.hdu.edu.cn/search.php?field=problem&amp;amp;key=2014%20Multi-University%20Training%20Contest%209&amp;amp;source=1&amp;amp;searchmode=source">2014 Multi-University Training Contest 9</a></div><br><p></p><hr><p></p><div class="panel_content">这题让我注意了矩阵模板的开销问题。1000X1000多次调用就会爆内存了。下面是用动态数组写的。效率非常慢，难以接受。</div><p></p><pre><code class="language-C++">#include&amp;lt;map&amp;gt;
#include&amp;lt;set&amp;gt;
#include&amp;lt;cmath&amp;gt;
#include&amp;lt;stack&amp;gt;
#include&amp;lt;queue&amp;gt;
#include&amp;lt;string&amp;gt;
#include&amp;lt;cstdio&amp;gt;
#include&amp;lt;vector&amp;gt;
#include&amp;lt;cctype&amp;gt;
#include&amp;lt;cassert&amp;gt;
#include&amp;lt;utility&amp;gt;
#include&amp;lt;numeric&amp;gt;
#include&amp;lt;cstring&amp;gt;
#include&amp;lt;iostream&amp;gt;
#include&amp;lt;algorithm&amp;gt;
using namespace std;
#define pr pair
#define PR pair&amp;lt;int,int&amp;gt;
#define MP make_pair
#define SI(x) set&amp;lt;x&amp;gt;::iterator
#define VI(x) vector&amp;lt;x&amp;gt;::iterator
#define MI(x,y) map&amp;lt;x,y&amp;gt;::iterator
#define SRI(x) set&amp;lt;x&amp;gt;::reverse_iterator
#define VRI(x) vector&amp;lt;x&amp;gt;::reverse_iterator
#define MRI(x,y) map&amp;lt;x,y&amp;gt;::reverse_iterator
#define F first
#define S second
#define Sz(x) (int)x.size()
#define clrQ(x) while(!x.empty)x.pop();
#define clr(x,y) memset(x,y,sizeof(x));
#if defined (_WIN32) || defined (__WIN32) || defined (WIN32) || defined (__WIN32__)
#define LL __int64
#define LLS &quot;%&quot; &quot;I&quot; &quot;6&quot; &quot;4&quot; &quot;d&quot;
#define LLU &quot;%&quot; &quot;I&quot; &quot;6&quot; &quot;4&quot; &quot;u&quot;
#define LL_MAX _I64_MAX
#else
#define LL long long
#define LLS &quot;%&quot; &quot;l&quot; &quot;l&quot; &quot;d&quot;
#define LLU &quot;%&quot; &quot;l&quot; &quot;l&quot; &quot;u&quot;
#define LL_MAX _I64_MAX
#endif
const int inf = ~0u &amp;gt;&amp;gt; 1;
const LL lnf = ~0ull &amp;gt;&amp;gt; 1;
/*start*/
#define MOD 6
int n, k;
struct Matrix {
    int n, m;
    int** M;
    Matrix(int n, int m) :n(n), m(m) {
        M = new int*[n];
        for (int i = 0; i &amp;lt; n; i++)
            M[i] = new int[m];
    }

    Matrix(int n, int m, int k) :
            n(n), m(m) {
        M = new int*[n];
        for (int i = 0; i &amp;lt; n; i++)
            M[i] = new int[m];
        Init(k);
    }

    ~Matrix() {
        if (M) {
            for (int i = 0; i &amp;lt; n; i++) {
                if (M[i]) {
                    delete[] M[i];
                    M[i] = NULL;
                }
            }
            delete[] M;
            M = NULL;
        }
    }

    void Init(bool k) { //k=1 返回单位矩阵，k=0 返回零矩阵
        for (int i = 0; i &amp;lt; n; i++)
            for (int j = 0; j &amp;lt; m; j++)
                M[i][j] = k * (i == j);
    }

    void out() {
        for (int i = 0; i &amp;lt; n; i++)
            for (int j = 0; j &amp;lt; m; j++)
                printf(&quot;%d%c&quot;, M[i][j], j == m - 1 ? '\n' : ' ');
    }

    Matrix &amp;amp; operator=(const Matrix&amp;amp; othr) {
        this-&amp;gt;~Matrix();
        n = othr.n;
        m = othr.m;
        M = new int*[n];
        for (int i = 0; i &amp;lt; n; i++)
            M[i] = new int[m];
        for (int i = 0; i &amp;lt; n; i++) {
            for (int j = 0; j &amp;lt; m; j++) {
                M[i][j] = othr.M[i][j];
            }
        }
        return *this;
    }

    Matrix(const Matrix &amp;amp; othr) {
        n = othr.n;
        m = othr.m;
        M = new int*[n];
        for (int i = 0; i &amp;lt; n; i++)
            M[i] = new int[m];
        for (int i = 0; i &amp;lt; n; i++) {
            for (int j = 0; j &amp;lt; m; j++) {
                M[i][j] = othr.M[i][j];
            }
        }
    }

    bool operator==(const Matrix&amp;amp; othr) const {
        if (n - othr.n || m - othr.m) return false;
        for (int i = 0; i &amp;lt; n; i++) {
            for (int j = 0; j &amp;lt; m; j++) {
                if (M[i][j] != othr.M[i][j]) return false;
            }
        }
        return true;
    }
    Matrix operator *(const Matrix&amp;amp; othr) const {
        if (m - othr.n) exit(1); //异常退出
        Matrix ans(n, othr.m, 0);
        for (int i = 0; i &amp;lt; n; i++)
            for (int j = 0; j &amp;lt; othr.m; j++)
                for (int k = 0; k &amp;lt; m; k++) {
                    ans.M[i][j] += M[i][k] * othr.M[k][j] % MOD;
                    if (ans.M[i][j] &amp;gt;= MOD) ans.M[i][j] -= MOD;
                    if (ans.M[i][j] &amp;lt; 0) ans.M[i][j] += MOD;
                }
        return ans;
    }
    Matrix operator *(const int&amp;amp; x) const {
        Matrix ans(n, m);
        for (int i = 0; i &amp;lt; n; i++)
            for (int j = 0; j &amp;lt; m; j++)
                ans.M[i][j] = M[i][j] * x % MOD;
        return ans;
    }
    Matrix operator +(const Matrix &amp;amp; othr) const {
        if (n - othr.n || m - othr.m) exit(1);
        Matrix ans(n, m);
        for (int i = 0; i &amp;lt; n; i++)
            for (int j = 0; j &amp;lt; m; j++) {
                ans.M[i][j] = M[i][j] + othr.M[i][j];
                if (ans.M[i][j] &amp;gt;= MOD) ans.M[i][j] -= MOD;
                if (ans.M[i][j] &amp;lt; 0) ans.M[i][j] += MOD;
            }
        return ans;
    }

    Matrix operator -(const Matrix&amp;amp; othr) const {
        if (n - othr.n || m - othr.m) exit(1);
        Matrix ans(n, m);
        for (int i = 0; i &amp;lt; n; i++)
            for (int j = 0; j &amp;lt; m; j++) {
                ans.M[i][j] = M[i][j] - othr.M[i][j];
                if (ans.M[i][j] &amp;gt;= MOD) ans.M[i][j] -= MOD;
                if (ans.M[i][j] &amp;lt; 0) ans.M[i][j] += MOD;
            }
        return ans;
    }

    Matrix operator ^(int x) const {
        if (n - m) exit(1);
        Matrix ans(n, m, 1), base = *this;
        while (x &amp;gt; 0) {
            if (x &amp;amp; 1) ans = ans * base;
            base = base * base;
            x &amp;gt;&amp;gt;= 1;
        }
        return ans;
    }
};

int main(int argc, char **argv) {
    while (~scanf(&quot;%d%d&quot;, &amp;amp;n, &amp;amp;k)) {
        if (n == 0 &amp;amp;&amp;amp; k == 0) break;
        Matrix A(n, k, 0), B(k, n, 0);
        for (int i = 0; i &amp;lt; n; i++) {
            for (int j = 0; j &amp;lt; k; j++) {
                scanf(&quot;%d&quot;, &amp;amp;A.M[i][j]);
            }
        }
        for (int i = 0; i &amp;lt; k; i++) {
            for (int j = 0; j &amp;lt; n; j++) {
                scanf(&quot;%d&quot;, &amp;amp;B.M[i][j]);
            }
        }
        Matrix mat = B * A;
        int r = n * n - 1;
        Matrix res = A * (mat ^ r) * B;
        int ans = 0;
        for (int i = 0; i &amp;lt; n; i++) {
            for (int j = 0; j &amp;lt; n; j++) {
                ans += res.M[i][j];
            }
        }
        printf(&quot;%d\n&quot;, ans);
    }
}
</code></pre><p>然后又试了试vector，虽然简单不少，但是仍然很慢：</p><pre><code class="language-C++">#include&amp;lt;map&amp;gt;
#include&amp;lt;set&amp;gt;
#include&amp;lt;cmath&amp;gt;
#include&amp;lt;stack&amp;gt;
#include&amp;lt;queue&amp;gt;
#include&amp;lt;string&amp;gt;
#include&amp;lt;cstdio&amp;gt;
#include&amp;lt;vector&amp;gt;
#include&amp;lt;cctype&amp;gt;
#include&amp;lt;cassert&amp;gt;
#include&amp;lt;utility&amp;gt;
#include&amp;lt;numeric&amp;gt;
#include&amp;lt;cstring&amp;gt;
#include&amp;lt;iostream&amp;gt;
#include&amp;lt;algorithm&amp;gt;
using namespace std;
#define pr pair
#define PR pair&amp;lt;int,int&amp;gt;
#define MP make_pair
#define SI(x) set&amp;lt;x&amp;gt;::iterator
#define VI(x) vector&amp;lt;x&amp;gt;::iterator
#define MI(x,y) map&amp;lt;x,y&amp;gt;::iterator
#define SRI(x) set&amp;lt;x&amp;gt;::reverse_iterator
#define VRI(x) vector&amp;lt;x&amp;gt;::reverse_iterator
#define MRI(x,y) map&amp;lt;x,y&amp;gt;::reverse_iterator
#define F first
#define S second
#define Sz(x) (int)x.size()
#define clrQ(x) while(!x.empty)x.pop();
#define clr(x,y) memset(x,y,sizeof(x));
#if defined (_WIN32) || defined (__WIN32) || defined (WIN32) || defined (__WIN32__)
#define LL __int64
#define LLS &quot;%&quot; &quot;I&quot; &quot;6&quot; &quot;4&quot; &quot;d&quot;
#define LLU &quot;%&quot; &quot;I&quot; &quot;6&quot; &quot;4&quot; &quot;u&quot;
#define LL_MAX _I64_MAX
#else
#define LL long long
#define LLS &quot;%&quot; &quot;l&quot; &quot;l&quot; &quot;d&quot;
#define LLU &quot;%&quot; &quot;l&quot; &quot;l&quot; &quot;u&quot;
#define LL_MAX _I64_MAX
#endif
const int inf = ~0u &amp;gt;&amp;gt; 1;
const LL lnf = ~0ull &amp;gt;&amp;gt; 1;
/*start*/
#define MOD 6
int n, k;
struct Matrix {
    int n, m;
    vector&amp;lt;vector&amp;lt;int&amp;gt; &amp;gt;M;
    Matrix(int n, int m) :n(n), m(m) {
        alloc();
    }

    Matrix(int n, int m, int k) :
            n(n), m(m) {
        alloc();
        Init(k);
    }
    void alloc(){
        M.resize(n);
        for (int i = 0; i &amp;lt; n; i++)
            M[i].resize(m);
    }

    void Init(bool k) { //k=1 返回单位矩阵，k=0 返回零矩阵
        for (int i = 0; i &amp;lt; n; i++)
            for (int j = 0; j &amp;lt; m; j++)
                M[i][j] = k * (i == j);
    }

    void out() {
        for (int i = 0; i &amp;lt; n; i++)
            for (int j = 0; j &amp;lt; m; j++)
                printf(&quot;%d%c&quot;, M[i][j], j == m - 1 ? '\n' : ' ');
    }

    bool operator==(const Matrix&amp;amp; othr) const {
        if (n - othr.n || m - othr.m) return false;
        for (int i = 0; i &amp;lt; n; i++) {
            for (int j = 0; j &amp;lt; m; j++) {
                if (M[i][j] != othr.M[i][j]) return false;
            }
        }
        return true;
    }
    Matrix operator *(const Matrix&amp;amp; othr) const {
        if (m - othr.n) exit(1); //异常退出
        Matrix ans(n, othr.m, 0);
        for (int i = 0; i &amp;lt; n; i++)
            for (int j = 0; j &amp;lt; othr.m; j++)
                for (int k = 0; k &amp;lt; m; k++) {
                    ans.M[i][j] += M[i][k] * othr.M[k][j] % MOD;
                    if (ans.M[i][j] &amp;gt;= MOD) ans.M[i][j] -= MOD;
                    if (ans.M[i][j] &amp;lt; 0) ans.M[i][j] += MOD;
                }
        return ans;
    }
    Matrix operator *(const int&amp;amp; x) const {
        Matrix ans(n, m);
        for (int i = 0; i &amp;lt; n; i++)
            for (int j = 0; j &amp;lt; m; j++)
                ans.M[i][j] = M[i][j] * x % MOD;
        return ans;
    }
    Matrix operator +(const Matrix &amp;amp; othr) const {
        if (n - othr.n || m - othr.m) exit(1);
        Matrix ans(n, m);
        for (int i = 0; i &amp;lt; n; i++)
            for (int j = 0; j &amp;lt; m; j++) {
                ans.M[i][j] = M[i][j] + othr.M[i][j];
                if (ans.M[i][j] &amp;gt;= MOD) ans.M[i][j] -= MOD;
                if (ans.M[i][j] &amp;lt; 0) ans.M[i][j] += MOD;
            }
        return ans;
    }

    Matrix operator -(const Matrix&amp;amp; othr) const {
        if (n - othr.n || m - othr.m) exit(1);
        Matrix ans(n, m);
        for (int i = 0; i &amp;lt; n; i++)
            for (int j = 0; j &amp;lt; m; j++) {
                ans.M[i][j] = M[i][j] - othr.M[i][j];
                if (ans.M[i][j] &amp;gt;= MOD) ans.M[i][j] -= MOD;
                if (ans.M[i][j] &amp;lt; 0) ans.M[i][j] += MOD;
            }
        return ans;
    }

    Matrix operator ^(int x) const {
        if (n - m) exit(1);
        Matrix ans(n, m, 1), base = *this;
        while (x &amp;gt; 0) {
            if (x &amp;amp; 1) ans = ans * base;
            base = base * base;
            x &amp;gt;&amp;gt;= 1;
        }
        return ans;
    }
};

int main(int argc, char **argv) {
    while (~scanf(&quot;%d%d&quot;, &amp;amp;n, &amp;amp;k)) {
        if (n == 0 &amp;amp;&amp;amp; k == 0) break;
        Matrix A(n, k, 0), B(k, n, 0);
        for (int i = 0; i &amp;lt; n; i++) {
            for (int j = 0; j &amp;lt; k; j++) {
                scanf(&quot;%d&quot;, &amp;amp;A.M[i][j]);
            }
        }
        for (int i = 0; i &amp;lt; k; i++) {
            for (int j = 0; j &amp;lt; n; j++) {
                scanf(&quot;%d&quot;, &amp;amp;B.M[i][j]);
            }
        }
        Matrix mat = B * A;
        int r = n * n - 1;
        Matrix res = A * (mat ^ r) * B;
        int ans = 0;
        for (int i = 0; i &amp;lt; n; i++) {
            for (int j = 0; j &amp;lt; n; j++) {
                ans += res.M[i][j];
            }
        }
        printf(&quot;%d\n&quot;, ans);
    }
}
</code></pre><p>感觉其他方法还比较麻烦。算了就这样吧~</p><p>&nbsp;</p></article></div><div class="card-action"><i class="material-icons">local_offer</i> <a class="tag" href="http://keyin.me/tags/%E7%9F%A9%E9%98%B5%E6%9A%B4%E5%8A%9B">#[矩阵,暴力]</a>&nbsp;</div><div class="card-action"><div class="comments"><div id="disqus_thread"></div></div><script type="text/javascript">var disqus_shortname = 'keyin';

     
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();</script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript></div></div><div class="pagination-single"><span class="pagination-item previous"><i class="material-icons">navigate_before</i> <a href="http://keyin.me/post/hdu-4952-number-transformation/" rel="prev">HDU 4952 Number Transformation</a> </span><span class="pagination-item next"><i class="material-icons">navigate_next</i> <a href="http://keyin.me/post/sublime-config-web/" rel="next">用Sublime Text 3 dev 做网页开发的配置</a></span></div></div></section></div></section><footer class="page-footer"><div class="container"><div class="row"><div class="col l6 s12"><h5 class="white-text">World of Forks</h5><p class="grey-text text-lighten-4">Theme <a href="" target="_blank">YAMT</a> designed by <a href="#!">Kevin Tan</a> with ❤</p></div><div class="col l4 offset-l2 s12"><h5 class="white-text">My Friends</h5><ul><li><a class="grey-text text-lighten-3" href="https://frantic1048.logdown.com/" target="_blank">Frantic1048</a></li><li><a class="grey-text text-lighten-3" href="https://hclmaster.github.io/" target="_blank">HclMaster</a></li><li><a class="grey-text text-lighten-3" href="https://whst.github.io/" target="_blank">WANG Hsü-Tung</a></li></ul></div></div></div><div class="footer-copyright"><div class="container">Copyleft@Kevin Tan</div></div></footer></main><svg style="position: absolute; width: 0; height: 0; overflow: hidden" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><symbol id="svg-icons-google-plus3" viewBox="0 0 32 32"><title>google-plus3</title><path d="M16 0c-8.838 0-16 7.162-16 16s7.162 16 16 16 16-7.163 16-16-7.163-16-16-16zM12 24c-4.425 0-8-3.575-8-8s3.575-8 8-8c2.162 0 3.969 0.787 5.363 2.094l-2.175 2.088c-0.594-0.569-1.631-1.231-3.188-1.231-2.731 0-4.963 2.263-4.963 5.050s2.231 5.050 4.963 5.050c3.169 0 4.356-2.275 4.538-3.45h-4.537v-2.744h7.556c0.069 0.4 0.125 0.8 0.125 1.325 0 4.575-3.063 7.819-7.681 7.819zM26 16v2h-2v-2h-2v-2h2v-2h2v2h2v2h-2z"></path></symbol><symbol id="svg-icons-twitter" viewBox="0 0 32 32"><title>twitter</title><path d="M32 7.075c-1.175 0.525-2.444 0.875-3.769 1.031 1.356-0.813 2.394-2.1 2.887-3.631-1.269 0.75-2.675 1.3-4.169 1.594-1.2-1.275-2.906-2.069-4.794-2.069-3.625 0-6.563 2.938-6.563 6.563 0 0.512 0.056 1.012 0.169 1.494-5.456-0.275-10.294-2.888-13.531-6.862-0.563 0.969-0.887 2.1-0.887 3.3 0 2.275 1.156 4.287 2.919 5.463-1.075-0.031-2.087-0.331-2.975-0.819 0 0.025 0 0.056 0 0.081 0 3.181 2.263 5.838 5.269 6.437-0.55 0.15-1.131 0.231-1.731 0.231-0.425 0-0.831-0.044-1.237-0.119 0.838 2.606 3.263 4.506 6.131 4.563-2.25 1.762-5.075 2.813-8.156 2.813-0.531 0-1.050-0.031-1.569-0.094 2.913 1.869 6.362 2.95 10.069 2.95 12.075 0 18.681-10.006 18.681-18.681 0-0.287-0.006-0.569-0.019-0.85 1.281-0.919 2.394-2.075 3.275-3.394z"></path></symbol><symbol id="svg-icons-sina-weibo" viewBox="0 0 32 32"><title>sina-weibo</title><path d="M13.444 28.063c-5.3 0.525-9.875-1.875-10.219-5.35-0.344-3.481 3.675-6.719 8.969-7.244 5.3-0.525 9.875 1.875 10.213 5.35 0.35 3.481-3.669 6.725-8.963 7.244zM24.038 16.519c-0.45-0.137-0.762-0.225-0.525-0.819 0.512-1.287 0.563-2.394 0.006-3.188-1.038-1.481-3.881-1.406-7.137-0.037 0 0-1.025 0.444-0.762-0.363 0.5-1.613 0.425-2.956-0.356-3.738-1.769-1.769-6.469 0.069-10.5 4.1-3.013 3.006-4.763 6.213-4.763 8.981 0 5.288 6.787 8.506 13.425 8.506 8.7 0 14.494-5.056 14.494-9.069 0-2.431-2.044-3.806-3.881-4.375z"></path><path d="M29.819 6.831c-2.1-2.331-5.2-3.219-8.063-2.612v0c-0.663 0.144-1.081 0.794-0.938 1.45 0.144 0.662 0.788 1.081 1.45 0.938 2.038-0.431 4.238 0.2 5.731 1.856s1.9 3.912 1.256 5.888v0c-0.206 0.644 0.144 1.331 0.788 1.544 0.644 0.206 1.331-0.144 1.544-0.787v-0.006c0.9-2.762 0.331-5.938-1.769-8.269z"></path><path d="M26.587 9.75c-1.025-1.137-2.538-1.569-3.925-1.269-0.569 0.119-0.931 0.688-0.813 1.256 0.125 0.569 0.688 0.931 1.25 0.806v0c0.681-0.144 1.419 0.069 1.919 0.619 0.5 0.556 0.637 1.313 0.419 1.975v0c-0.175 0.55 0.125 1.15 0.681 1.331 0.556 0.175 1.15-0.125 1.331-0.681 0.438-1.356 0.163-2.906-0.863-4.037z"></path><path d="M13.738 21.769c-0.188 0.319-0.594 0.469-0.912 0.337-0.319-0.125-0.412-0.488-0.231-0.794 0.188-0.306 0.581-0.456 0.894-0.337 0.313 0.113 0.425 0.469 0.25 0.794zM12.044 23.931c-0.512 0.819-1.613 1.175-2.438 0.8-0.813-0.369-1.056-1.319-0.544-2.119 0.506-0.794 1.569-1.15 2.387-0.806 0.831 0.356 1.1 1.3 0.594 2.125zM13.969 18.144c-2.519-0.656-5.369 0.6-6.463 2.819-1.119 2.262-0.037 4.781 2.506 5.606 2.637 0.85 5.75-0.456 6.831-2.894 1.069-2.394-0.262-4.85-2.875-5.531z"></path></symbol><symbol id="svg-icons-github" viewBox="0 0 32 32"><title>github</title><path d="M16 0.395c-8.836 0-16 7.163-16 16 0 7.069 4.585 13.067 10.942 15.182 0.8 0.148 1.094-0.347 1.094-0.77 0-0.381-0.015-1.642-0.022-2.979-4.452 0.968-5.391-1.888-5.391-1.888-0.728-1.849-1.776-2.341-1.776-2.341-1.452-0.993 0.11-0.973 0.11-0.973 1.606 0.113 2.452 1.649 2.452 1.649 1.427 2.446 3.743 1.739 4.656 1.33 0.143-1.034 0.558-1.74 1.016-2.14-3.554-0.404-7.29-1.777-7.29-7.907 0-1.747 0.625-3.174 1.649-4.295-0.166-0.403-0.714-2.030 0.155-4.234 0 0 1.344-0.43 4.401 1.64 1.276-0.355 2.645-0.532 4.005-0.539 1.359 0.006 2.729 0.184 4.008 0.539 3.054-2.070 4.395-1.64 4.395-1.64 0.871 2.204 0.323 3.831 0.157 4.234 1.026 1.12 1.647 2.548 1.647 4.295 0 6.145-3.743 7.498-7.306 7.895 0.574 0.497 1.085 1.47 1.085 2.963 0 2.141-0.019 3.864-0.019 4.391 0 0.426 0.288 0.925 1.099 0.768 6.354-2.118 10.933-8.113 10.933-15.18 0-8.837-7.164-16-16-16z"></path></symbol></defs></svg><script src="//cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><script type="text/javascript" src="http://keyin.me/js/materialize.min.js"></script><script type="text/javascript" src="http://keyin.me/js/index-25f9a7ef56.js"></script></body></html>